{
  "feature": "Note Export & Sharing",
  "description": "# Note Export & Sharing\n\nImplement export to multiple formats (Markdown, TXT, PDF, JSON) and sharing to other apps. Users should have full control over their data and be able to use it outside the app.\n\n## Rationale\nAddresses Simplenote's limited export functionality (pain-5-3), a major reason users leave for more flexible apps. Data portability is essential for user trust and addresses concerns about being locked into one app. Competitor gap-10 emphasizes privacy and local storage.\n\n## User Stories\n- As a user, I want to export my notes to Markdown, so that I can use them in other apps or publish them\n- As a user, I want to share notes with others via email or messaging, so that I can collaborate\n- As a user, I want to backup all my notes to a file, so that I have control over my data\n\n## Acceptance Criteria\n- [ ] Export single note to Markdown, TXT, PDF, and JSON formats\n- [ ] Export entire folder or all notes as ZIP archive\n- [ ] Share note text to other apps via native share sheet\n- [ ] Exported Markdown preserves formatting structure\n- [ ] PDF export includes proper formatting and page breaks\n- [ ] JSON export allows for backup and potential migration\n- [ ] Export process is fast even for large note collections\n",
  "created_at": "2026-02-07T23:21:17.346Z",
  "updated_at": "2026-02-08T00:31:33.343Z",
  "status": "in_progress",
  "workflow_type": "feature",
  "workflow_rationale": "This is a new feature implementation for a Flutter app. The feature workflow is appropriate as we're adding export functionality that spans multiple architectural layers (domain use cases, data service, presentation UI) within a single service. The app follows Clean Architecture with clear separation between domain, data, and presentation layers.",
  "phases": [
    {
      "id": "phase-1-domain",
      "name": "Domain Layer - Export Use Cases",
      "type": "implementation",
      "description": "Create export-related use cases in the domain layer following the existing use case pattern",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Add export methods to NoteRepository interface",
          "service": "domain",
          "files_to_modify": [
            "lib/domain/repositories/note_repository.dart"
          ],
          "files_to_create": [],
          "patterns_from": [
            "lib/domain/repositories/note_repository.dart"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'Future<String> exportNote' lib/domain/repositories/note_repository.dart && echo 'Repository interface updated'",
            "expected": "Repository interface updated"
          },
          "status": "completed"
        },
        {
          "id": "subtask-1-2",
          "description": "Create ExportNoteUseCase for single note export",
          "service": "domain",
          "files_to_modify": [],
          "files_to_create": [
            "lib/domain/usecases/export/export_note_usecase.dart"
          ],
          "patterns_from": [
            "lib/domain/usecases/note/get_note_by_id_usecase.dart"
          ],
          "verification": {
            "type": "command",
            "command": "flutter analyze lib/domain/usecases/export/export_note_usecase.dart",
            "expected": "No issues found"
          },
          "status": "completed"
        },
        {
          "id": "subtask-1-3",
          "description": "Create ExportFolderUseCase for folder export",
          "service": "domain",
          "files_to_modify": [],
          "files_to_create": [
            "lib/domain/usecases/export/export_folder_usecase.dart"
          ],
          "patterns_from": [
            "lib/domain/usecases/note/get_note_list_usecase.dart"
          ],
          "verification": {
            "type": "command",
            "command": "flutter analyze lib/domain/usecases/export/export_folder_usecase.dart",
            "expected": "No issues found"
          },
          "status": "completed"
        },
        {
          "id": "subtask-1-4",
          "description": "Create ExportAllNotesUseCase for full backup",
          "service": "domain",
          "files_to_modify": [],
          "files_to_create": [
            "lib/domain/usecases/export/export_all_notes_usecase.dart"
          ],
          "patterns_from": [
            "lib/domain/usecases/note/get_note_list_usecase.dart"
          ],
          "verification": {
            "type": "command",
            "command": "flutter analyze lib/domain/usecases/export/export_all_notes_usecase.dart",
            "expected": "No issues found"
          },
          "status": "completed"
        },
        {
          "id": "subtask-1-5",
          "description": "Create ShareNoteUseCase for native sharing",
          "service": "domain",
          "files_to_modify": [],
          "files_to_create": [
            "lib/domain/usecases/export/share_note_usecase.dart"
          ],
          "patterns_from": [
            "lib/domain/usecases/note/get_note_by_id_usecase.dart"
          ],
          "verification": {
            "type": "command",
            "command": "flutter analyze lib/domain/usecases/export/share_note_usecase.dart",
            "expected": "No issues found"
          },
          "status": "completed"
        }
      ]
    },
    {
      "id": "phase-2-data",
      "name": "Data Layer - Export Service",
      "type": "implementation",
      "description": "Create export service for format conversions (Markdown, TXT, PDF, JSON, ZIP)",
      "depends_on": [
        "phase-1-domain"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Create ExportService base class with format converters",
          "service": "data",
          "files_to_modify": [],
          "files_to_create": [
            "lib/data/services/export_service.dart"
          ],
          "patterns_from": [
            "lib/services/storage/isar_service.dart"
          ],
          "verification": {
            "type": "command",
            "command": "flutter analyze lib/data/services/export_service.dart",
            "expected": "No issues found"
          },
          "status": "completed"
        },
        {
          "id": "subtask-2-2",
          "description": "Implement Markdown export with formatting preservation",
          "service": "data",
          "files_to_modify": [
            "lib/data/services/export_service.dart"
          ],
          "files_to_create": [],
          "patterns_from": [
            "lib/data/services/export_service.dart"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify Markdown export includes title (# heading), preserves line breaks, and handles empty content"
          },
          "status": "completed"
        },
        {
          "id": "subtask-2-3",
          "description": "Implement TXT export (plain text)",
          "service": "data",
          "files_to_modify": [
            "lib/data/services/export_service.dart"
          ],
          "files_to_create": [],
          "patterns_from": [
            "lib/data/services/export_service.dart"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify TXT export includes title and content as plain text"
          },
          "status": "completed",
          "notes": "TXT export fully implemented with proper documentation. Converts notes to plain text format without markdown syntax, includes title separation, handles empty content.",
          "updated_at": "2026-02-07T23:48:16.419623+00:00"
        },
        {
          "id": "subtask-2-4",
          "description": "Implement JSON export for backup/migration",
          "service": "data",
          "files_to_modify": [
            "lib/data/services/export_service.dart"
          ],
          "files_to_create": [],
          "patterns_from": [
            "lib/data/services/export_service.dart"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify JSON export includes all note fields (id, title, content, isPinned, folderId, dates)"
          },
          "status": "completed",
          "notes": "JSON export fully implemented with dart:convert. Includes all note fields: id, title, content, isPinned, folderId, createdAt, updatedAt. Uses jsonEncode for proper serialization and handles optional fields with null-safety.",
          "updated_at": "2026-02-08T00:15:00.000000+00:00"
        },
        {
          "id": "subtask-2-5",
          "description": "Implement PDF export with proper formatting",
          "service": "data",
          "files_to_modify": [
            "lib/data/services/export_service.dart"
          ],
          "files_to_create": [],
          "patterns_from": [
            "lib/data/services/export_service.dart"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify PDF export includes title, content, proper page breaks, and readable formatting"
          },
          "status": "completed",
          "notes": "PDF export fully implemented using pdf package. Generates professional PDFs with A4 page format, 48pt margins, 24pt bold title with proper spacing, 12pt content with 1.5 line height. Created _ExportContent wrapper class to handle binary PDF data (Uint8List) alongside text formats. Refactored export flow to support both text and binary content types.",
          "updated_at": "2026-02-08T00:25:00.000000+00:00"
        },
        {
          "id": "subtask-2-6",
          "description": "Implement ZIP archive export for multiple notes",
          "service": "data",
          "files_to_modify": [
            "lib/data/services/export_service.dart"
          ],
          "files_to_create": [],
          "patterns_from": [
            "lib/data/services/export_service.dart"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify ZIP export creates archive with individual note files and valid folder structure"
          },
          "status": "completed",
          "notes": "ZIP export fully implemented using archive package. Creates ZIP archives containing all notes in specified format (markdown, txt, pdf, json). Each note is saved as individual file with sanitized filename. Handles duplicate filenames with numbering suffix (note_2.md, note_3.md). Archive named with format, note count, and timestamp for uniqueness. Added _generateUniqueFileName, _generateZipFileName, and _saveZipFile helper methods.",
          "updated_at": "2026-02-08T00:30:00.000000+00:00"
        },
        {
          "id": "subtask-2-7",
          "description": "Implement export methods in NoteRepositoryImpl",
          "service": "data",
          "files_to_modify": [
            "lib/data/repositories/note_repository_impl.dart"
          ],
          "files_to_create": [],
          "patterns_from": [
            "lib/data/repositories/note_repository_impl.dart"
          ],
          "verification": {
            "type": "command",
            "command": "flutter analyze lib/data/repositories/note_repository_impl.dart",
            "expected": "No issues found"
          },
          "status": "completed",
          "notes": "Export methods implemented in NoteRepositoryImpl. Added ExportService dependency with optional injection for testability. Implemented exportNote (single note to format), exportFolder (folder notes as ZIP), exportAllNotes (all notes as ZIP), and getShareableNoteContent (shareable text). Added _parseExportFormat helper for format string to enum conversion.",
          "updated_at": "2026-02-08T00:35:00.000000+00:00"
        }
      ]
    },
    {
      "id": "phase-3-packages",
      "name": "Add Required Dependencies",
      "type": "implementation",
      "description": "Add Flutter packages for export functionality (share_plus, pdf, printing, archive, path)",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Add export-related packages to pubspec.yaml",
          "service": "app",
          "files_to_modify": [
            "pubspec.yaml"
          ],
          "files_to_create": [],
          "patterns_from": [
            "pubspec.yaml"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'share_plus:' pubspec.yaml && grep -q 'pdf:' pubspec.yaml && grep -q 'printing:' pubspec.yaml && grep -q 'archive:' pubspec.yaml && echo 'Packages added'",
            "expected": "Packages added"
          },
          "status": "completed"
        },
        {
          "id": "subtask-3-2",
          "description": "Run flutter pub get to install packages",
          "service": "app",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "flutter pub get",
            "expected": "dependencies downloaded"
          },
          "status": "completed",
          "notes": "Dependencies successfully installed. share_plus 7.2.2, pdf 3.11.3, printing 5.14.2, archive 3.6.1. Generated plugin registrants updated for Linux, macOS, and Windows platforms.",
          "updated_at": "2026-02-08T00:45:00.000000+00:00"
        }
      ]
    },
    {
      "id": "phase-4-di",
      "name": "Dependency Injection Setup",
      "type": "implementation",
      "description": "Register export service and use cases in service locator",
      "depends_on": [
        "phase-1-domain",
        "phase-3-packages"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Register ExportService in service locator",
          "service": "services",
          "files_to_modify": [
            "lib/services/di/service_locator.dart"
          ],
          "files_to_create": [],
          "patterns_from": [
            "lib/services/di/service_locator.dart"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'ExportService' lib/services/di/service_locator.dart && echo 'ExportService registered'",
            "expected": "ExportService registered"
          },
          "status": "completed"
        },
        {
          "id": "subtask-4-2",
          "description": "Register all export use cases in service locator",
          "service": "services",
          "files_to_modify": [
            "lib/services/di/service_locator.dart"
          ],
          "files_to_create": [],
          "patterns_from": [
            "lib/services/di/service_locator.dart"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'ExportNoteUseCase' lib/services/di/service_locator.dart && grep -q 'ShareNoteUseCase' lib/services/di/service_locator.dart && echo 'Use cases registered'",
            "expected": "Use cases registered"
          },
          "status": "completed",
          "notes": "Added imports for all export use cases (ExportNoteUseCase, ExportFolderUseCase, ExportAllNotesUseCase, ShareNoteUseCase) to service locator. Use cases require runtime parameters (noteId, folderId, format) and are documented with example usage for direct instantiation where needed.",
          "updated_at": "2026-02-08T00:50:00.000000+00:00"
        }
      ]
    },
    {
      "id": "phase-5-presentation",
      "name": "Presentation Layer - UI Components",
      "type": "implementation",
      "description": "Create view model and UI components for export functionality",
      "depends_on": [
        "phase-2-data",
        "phase-4-di"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Create ExportViewModel with export state management",
          "service": "presentation",
          "files_to_modify": [],
          "files_to_create": [
            "lib/presentation/providers/export_view_model.dart"
          ],
          "patterns_from": [
            "lib/presentation/providers/notes_view_model.dart"
          ],
          "verification": {
            "type": "command",
            "command": "flutter analyze lib/presentation/providers/export_view_model.dart",
            "expected": "No issues found"
          },
          "status": "completed",
          "notes": "ExportViewModel created following the pattern from NotesViewModel. Manages export state (isExporting, exportError, lastExportPath, shareableContent). Provides methods: exportNote(noteId, format), exportFolder(folderId), exportAllNotes(), getShareableContent(noteId), clearShareableContent(). Uses export use cases injected via NoteRepository. Returns bool success indicators and updates state with notifyListeners().",
          "updated_at": "2026-02-08T01:00:00.000000+00:00"
        },
        {
          "id": "subtask-5-2",
          "description": "Create ExportOptionsBottomSheet for format selection",
          "service": "presentation",
          "files_to_modify": [],
          "files_to_create": [
            "lib/presentation/screens/export/export_options_bottom_sheet.dart"
          ],
          "patterns_from": [
            "lib/presentation/screens/note_detail/note_detail_screen.dart"
          ],
          "verification": {
            "type": "command",
            "command": "flutter analyze lib/presentation/screens/export/export_options_bottom_sheet.dart",
            "expected": "No issues found"
          },
          "status": "pending"
        },
        {
          "id": "subtask-5-3",
          "description": "Add export button to NoteDetailScreen",
          "service": "presentation",
          "files_to_modify": [
            "lib/presentation/screens/note_detail/note_detail_screen.dart"
          ],
          "files_to_create": [],
          "patterns_from": [
            "lib/presentation/screens/note_detail/note_detail_screen.dart"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify export button appears in note detail screen and opens export options"
          },
          "status": "pending"
        },
        {
          "id": "subtask-5-4",
          "description": "Add bulk export option to home screen (folder/all notes)",
          "service": "presentation",
          "files_to_modify": [
            "lib/presentation/screens/home/home_screen.dart"
          ],
          "files_to_create": [],
          "patterns_from": [
            "lib/presentation/screens/home/home_screen.dart"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify export option available in home screen menu for exporting folders or all notes"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-6-integration",
      "name": "Integration and Testing",
      "type": "integration",
      "description": "End-to-end testing of export and sharing functionality",
      "depends_on": [
        "phase-5-presentation"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Test single note export to all formats",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Create a test note with title and content",
              "Open note detail screen",
              "Tap export button",
              "Select each format (Markdown, TXT, PDF, JSON)",
              "Verify each file is created and contains correct data",
              "Verify share sheet opens for native sharing"
            ]
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-2",
          "description": "Test folder export as ZIP archive",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Create multiple notes in a folder",
              "Select export from folder menu",
              "Choose ZIP format",
              "Verify ZIP file is created with all notes",
              "Extract and verify file structure"
            ]
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-3",
          "description": "Test export all notes functionality",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Create multiple notes across folders",
              "Select export all notes from settings",
              "Verify ZIP contains all notes",
              "Verify JSON backup includes all metadata"
            ]
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-4",
          "description": "Test native share functionality",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Open a note",
              "Tap share button",
              "Verify native share sheet opens",
              "Verify note text is included in share",
              "Test sharing to email, messages, etc."
            ]
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-5",
          "description": "Performance test with large note collections",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Create 100+ notes with varying content lengths",
              "Test export all notes",
              "Verify export completes in reasonable time (<10 seconds)",
              "Verify no memory issues or crashes"
            ]
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 6,
    "total_subtasks": 23,
    "services_involved": [
      "domain",
      "data",
      "presentation",
      "services"
    ],
    "parallelism": {
      "max_parallel_phases": 2,
      "parallel_groups": [
        {
          "phases": [
            "phase-1-domain",
            "phase-3-packages"
          ],
          "reason": "Domain layer design can happen in parallel with adding dependencies"
        }
      ],
      "recommended_workers": 1,
      "speedup_estimate": "Sequential execution recommended due to tight dependencies between layers"
    }
  },
  "verification_strategy": {
    "risk_level": "medium",
    "skip_validation": false,
    "test_creation_phase": "post_implementation",
    "test_types_required": [
      "integration"
    ],
    "security_scanning_required": false,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "All export formats produce valid output",
      "Native share sheet opens correctly",
      "ZIP archives contain all expected files",
      "Export works for single notes, folders, and all notes",
      "Export performs well with large collections",
      "No crashes or memory leaks"
    ],
    "verification_steps": [
      {
        "name": "Flutter Analyze",
        "command": "flutter analyze",
        "expected_outcome": "No issues found",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Integration Tests",
        "command": "flutter test test/integration/",
        "expected_outcome": "All tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Manual Export Testing",
        "command": "flutter run",
        "expected_outcome": "All export formats work correctly",
        "type": "manual",
        "required": true,
        "blocking": true
      }
    ],
    "reasoning": "Medium risk change involving file I/O, format conversions, and platform-specific sharing. Requires integration testing and manual verification of export outputs."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": false,
      "commands": [
        "flutter test test/unit/"
      ],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": true,
      "commands": [
        "flutter test test/integration/"
      ],
      "services_to_test": [
        "export_service",
        "export_usecases"
      ]
    },
    "e2e_tests": {
      "required": true,
      "commands": [
        "flutter test test/e2e/"
      ],
      "flows": [
        "export-single-note",
        "export-folder",
        "export-all-notes",
        "share-note"
      ]
    },
    "manual_verification": {
      "required": true,
      "checks": [
        "Export single note to Markdown, TXT, PDF, JSON",
        "Export folder as ZIP",
        "Export all notes as ZIP",
        "Share note via native share sheet",
        "Verify exported file contents"
      ]
    },
    "code_review_checks": {
      "required": true,
      "checks": [
        "Follows Clean Architecture pattern",
        "Use cases properly use Result type",
        "Error handling for export failures",
        "File permissions handled correctly",
        "No hardcoded paths"
      ]
    }
  },
  "qa_signoff": null,
  "planStatus": "in_progress",
  "xstateState": "ready_for_implementation",
  "executionPhase": "coding",
  "last_updated": "2026-02-08T00:40:00.000000+00:00"
}